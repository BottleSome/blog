/*FrontMainJS - SomeBottle*/
 /*q.js*/
var md;if("object"!==typeof $){$={ls:[],lss:"",aj:function(c,a,d,h,l,k){var f=new XMLHttpRequest,g="",n;for(n in a)g=g+n+"\x3d"+a[n]+"\x26";g=g.substring(0,g.length-1);"get"==h?f.open("get",c,k):"put"==h?(f.open("PUT",c,k),f.setRequestHeader("Content-type","application/json;charset\x3dUTF-8"),g=JSON.stringify(a)):"delete"==h?(f.open("DELETE",c,k),f.setRequestHeader("Content-type","application/json;charset\x3dUTF-8"),g=JSON.stringify(a)):f.open("post",c,k);f.setRequestHeader("Authorization",l);"multipart/form-data"!==h?(f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f.send(g)):f.send(a);f.onreadystatechange=function(){4==f.readyState&&200==f.status?d.success(f.responseText,c):4==f.readyState&&200!==f.status&&d.failed(f.status,c)};k||(void 0!==f.responseText?d.success(f.responseText,c):d.failed(f.status,c))}};var SC=function(c){return"body"==c?document.body:"html"==c?document.getElementsByTagName("html")[0]:document.getElementById(c)};$.script=function(c){$.scripturl||($.scripturl=[]);var a=document.createElement("script"),d=!1,h;for(h in $.ls)if($.ls[h]==c){d=!0;break}d||-1!=$.scripturl.indexOf(c)||($.ls[$.ls.length]=c,a.type="text/javascript",a.src=c,$.scripturl.push(c),document.body.appendChild(a))};$.ht=function(c,a,d){d=void 0===d?!0:d;var h=SC(a);if(!h)return console.log("Unable to find the Element:"+a),!1;h.innerHTML=c;os=h.getElementsByTagName("script");for(a=0;a<os.length;a++)if(void 0!==os[a].src&&null!==os[a].src&&""!==os[a].src)$.script(os[a].src);else try{c=os[a].innerHTML,d&&(c=B.r(c,"/*",""),c=B.r(c,"*/","")),eval(c)}catch(l){console.log("Page script Error: "+l.message)}};$.tr=function(c){b=c.split("?");return b[1]?b[0]:c}}if(!B){if(localStorage["obottle-ldpage"]){var e=document.getElementsByTagName("html")[0].innerHTML;document.getElementsByTagName("html")[0].innerHTML=e.replace("\x3c!--[LoadingArea]--\x3e",localStorage["obottle-ldpage"])}$.aj("./loading.html","",{success:function(c,a){B.hr("\x3c!--[LoadingArea]--\x3e",c);localStorage["obottle-ldpage"]=c},failed:function(c){console.log("LoadingPage Load Failed")}},"get","",!0);$.ht("\x3cscript src\x3d'./library.js'\x3e\x3c/script\x3e"+SC("container").innerHTML,"container");window.htmls={};var B={moreperpage:0,r:function(c,a,d,h){if(void 0===h||h)for(;-1!==c.indexOf(a);)c=c.replace(a,d);else c=c.replace(a,d);return c},hr:function(c,a){var d=document.getElementsByTagName("html")[0].innerHTML;document.getElementsByTagName("html")[0].innerHTML=this.r(d,c,a)},gt:function(c,a,d){d=(d=void 0===d?!1:d)?d:document.getElementsByTagName("html")[0].innerHTML;try{return d.split(c)[1].split(a)[0]}catch(h){return!1}},templonload:0,templateloaded:[],tpcheck:function(){this.loadshow();var c=this.gt("\x3c!--[PageType]--\x3e","\x3c!--[PageTypeEnd]--\x3e");if(window.templjson)if(window.mainjson||-1===window.templjson.usemain.indexOf(c))if("object"!==typeof showdown)a=this,setTimeout(function(){return a.tpcheck()},200);else{var a=this,d=window.templjson;d.necessary.push(c);c==d.templatehtmls.postlist&&d.necessary.push(d.templatehtmls.postitem);for(var h in d.necessary)if(-1==a.templateloaded.indexOf(d.necessary[h])){a.templonload+=1;var l=!1,k=q("r","template-"+d.necessary[h],"","","");k.c&&(l=!0,c=d.necessary[h],console.log("Template using cache:"+c),window.htmls[c]=k.c,a.templateloaded.push(c),--a.templonload);$.aj(d.necessary[h],"",{success:function(c,d){window.htmls[d]=c;l?k.c!==c?q("w","template-"+d,c,timestamp(),""):q("e","template-"+d,"","",1):(a.templateloaded.push(d),--a.templonload,q("w","template-"+d,c,timestamp(),""))},failed:function(a){console.log("Necessary HTML Load Failed...")}},"get","",!0)}var f=setInterval(function(){0>=a.templonload&&(clearInterval(f),a.renderer())},1E3)}else{var a=this;setTimeout(function(){return a.tpcheck()},200)}else{var g=this;$.aj("template.json","",{success:function(a){window.templjson=JSON.parse(a);return g.tpcheck()},failed:function(a){console.log("TemplateJson Load Failed.")}},"get","",!0)}window.mainjson||window.mainjsonrequest||(g=this,window.mainjsonrequest=!0,$.aj("main.json","",{success:function(a){window.mainjson=JSON.parse(a.replace(/[\r\n]/g,""));g.moreperpage=parseInt(window.mainjson.more_per_page)},failed:function(a){console.log("MainJson Load Failed")}},"get","",!0))},itempage:0,switchpage:0,nowpage:0,realpage:1,searchw:"",hashexist:!1,renderer:function(){var c=window.templjson;md=new showdown.Converter;var a=window.htmls[c.templatehtmls.cloth],d=window.htmls[c.templatehtmls.main],h=window.htmls[c.templatehtmls.comment],l=this.gt("\x3c!--[PageType]--\x3e","\x3c!--[PageTypeEnd]--\x3e"),k=window.mainjson;if(l==c.templatehtmls.post){var f=this.gt("\x3c!--[PostContent]--\x3e","\x3c!--[PostContentEnd]--\x3e"),g=this.gt("\x3c!--[PostTitle]--\x3e","\x3c!--[PostTitleEnd]--\x3e"),k=this.gt("\x3c!--[PostDate]--\x3e","\x3c!--[PostDateEnd]--\x3e"),n=this.gt("\x3c!--[PostTag]--\x3e","\x3c!--[PostTagEnd]--\x3e"),m=this.gt("\x3c!--[PostID]--\x3e","\x3c!--[PostIDEnd]--\x3e"),p=this.gt("\x3c!--[MainTitle]--\x3e","\x3c!--[MainTitleEnd]--\x3e").replace(/<\/?.+?>/g,""),f=this.r(window.htmls[c.templatehtmls.post],"{[postcontent]}",md.makeHtml(f.trim())),g=this.r(f,"{[posttitle]}",g),f=[];isNaN(k)?n="\u9875\u9762":(f=n.split(","),n="",f.forEach(function(a,d){n=n+'\x3ca href\x3d"'+c.generatehtmls.tags+"#"+encodeURIComponent(a)+'" class\x3d"taglink"\x3e'+a+"\x3c/a\x3e,"}),n=n.substr(0,n.length-1));g=this.r(g,"{[posttags]}",n);g=this.r(g,"{[postdate]}",k);d=this.r(d,"{[contents]}",g);a=this.r(a,"{[main]}",d);a=this.r(a,"{[title]}",p);a=this.r(a,"{[comments]}",h);a=this.r(a,"{[pid]}",m);a=this.r(a,"{[pagetype]}",l);isNaN(k)&&(a=a.split("\x3c!--PostEnd--\x3e")[0]+"\x3c!--PostEnd--\x3e");$.ht(a,"container");this.loadhide()}else if(l==c.templatehtmls.postlist){var t=this,f=this.gt("\x3c!--[PostContent]--\x3e","\x3c!--[PostContentEnd]--\x3e"),p=this.gt("\x3c!--[MainTitle]--\x3e","\x3c!--[MainTitleEnd]--\x3e").replace(/<\/?.+?>/g,""),p=p.replace("-",""),f=this.r(window.htmls[c.templatehtmls.postlist],"{[postitems]}",md.makeHtml(f.trim())),d=this.r(d,"{[contents]}",f),a=this.r(a,"{[main]}",d),a=this.r(a,"{[title]}",p),a=this.r(a,"{[pagetype]}",l);this.itempage=parseInt(k.posts_per_page);$.ht(a,"container");this.loadhide();var v=setInterval(function(){if(t.gt("\x3c!--[PageType]","[PageTypeEnd]--\x3e")!==c.templatehtmls.postlist)return PJAX.sel("container"),PJAX.start(),clearInterval(v),!1;t.indexpagechecker()},500)}else if(l==c.templatehtmls.archives){var p=this.gt("\x3c!--[MainTitle]--\x3e","\x3c!--[MainTitleEnd]--\x3e").replace(/<\/?.+?>/g,""),h=k.dateindex,r="",x=0;for(f in h)m=h[f].toString().substring(0,4),m!==x&&(x=m,r=""!==r?r+("\x3c/ul\x3e\x3ch2\x3e\u00b7 "+m+"\x3c/h2\x3e\x3cul\x3e"):r+("\x3ch2\x3e\u00b7 "+m+"\x3c/h2\x3e\x3cul\x3e")),m=f.replace("post",""),g=Base64.decode(k.postindex[m].title),r=k.postindex[m].link?r+("\x3cli\x3e\x3ca class\x3d'taglink' href\x3d'"+k.postindex[m].link+".html'\x3e"+g+"\x3c/a\x3e\x3c/li\x3e"):r+("\x3cli\x3e\x3ca class\x3d'taglink' href\x3d'post-"+m+".html'\x3e"+g+"\x3c/a\x3e\x3c/li\x3e");f=this.r(window.htmls[c.templatehtmls.archives],"{[archives]}",r+"\x3c/ul\x3e");d=this.r(d,"{[contents]}",f);a=this.r(a,"{[main]}",d);a=this.r(a,"{[title]}",p);a=this.r(a,"{[pagetype]}",l);$.ht(a,"container");this.loadhide()}else if(l==c.templatehtmls.tags){var p=this.gt("\x3c!--[MainTitle]--\x3e","\x3c!--[MainTitleEnd]--\x3e").replace(/<\/?.+?>/g,""),h=$.tr(window.location.href),u="",t=this,k=k.postindex,w=[];for(g in k)m=k[g].tags.split(","),m.forEach(function(a,c){""!==a&&-1==w.indexOf(a)&&w.push(a)});w.forEach(function(a,c){u+="[\x3ca href\x3d'#"+encodeURIComponent(a)+"' class\x3d'itemlink'\x3e"+a+"\x3c/a\x3e]"});this.alltaghtml=u;-1!==h.indexOf("#")&&(this.nowtag=m=h.split("#")[1],"alltags"!==m&&(u="\x3cscript\x3eB.taguper('"+m+"');PJAX.start();\x3c/script\x3e"));v=setInterval(function(){if(-1==window.location.href.indexOf(c.generatehtmls.tags)&&-1==window.location.href.indexOf(c.generatehtmls.tags.replace(".html","")))return PJAX.sel("container"),PJAX.start(),clearInterval(v),!1;t.tagpagechecker()},500);f=this.r(window.htmls[c.templatehtmls.tags],"{[tags]}",u);d=this.r(d,"{[contents]}",f);a=this.r(a,"{[main]}",d);a=this.r(a,"{[title]}",p);a=this.r(a,"{[pagetype]}",l);$.ht(a,"container");this.loadhide()}},nowtag:"",alltaghtml:"",taguper:function(c){c=decodeURIComponent(c);document.getElementsByTagName("html");var a=window.mainjson,d=a.dateindex,h=a.postindex,a=[],l="",k;for(k in d)d=k.replace("post",""),-1!==h[d].tags.indexOf(c)&&a.push(d);l+="\x3cul\x3e";a.forEach(function(a,c){var d=h[a],f="post-"+a+".html";d.link&&(f=d.link+".html");l+="\x3cli\x3e\x3ca class\x3d'taglink' href\x3d'"+f+"'\x3e"+Base64.decode(d.title)+"\x3c/a\x3e\x3c/li\x3e"});SC("tags").innerHTML=l},tagpagechecker:function(){document.getElementsByTagName("html");var c=$.tr(window.location.href);-1==c.indexOf("#")?(PJAX.pause(),window.location.href+="#alltags",PJAX.start()):(c=c.split("#")[1],this.nowtag!==c&&(this.nowtag=c,"alltags"==c?SC("tags")&&(SC("tags").innerHTML=this.alltaghtml):this.taguper(c),PJAX.start()))},indexpagechecker:function(){document.getElementsByTagName("html");var c=window.templjson,a=$.tr(decodeURIComponent(window.location.href)),d=window.mainjson,h=parseInt(d.posts_per_page);if(-1!==a.indexOf("#")){this.hashexist=!0;var l=a.split("#")[1];if(-1==a.indexOf("#!")){if(!isNaN(l)){var k=parseInt(l)-1;this.nowpage!==k&&(this.nowpage=k,this.itempage=h*k*this.moreperpage,SC("postitems").innerHTML="",this.more(),this.realpage=k+1,this.switchpage=0)}}else if(h="",c=window.htmls[c.templatehtmls.postitem],a=a.split("#!")[1],a!==this.searchw){this.searchw=a;d=d.postindex;for(k in d){var f=Base64.decode(d[k].title),g=Base64.decode(d[k].intro),l=d[k].date,n=d[k].tags;if(-1!==f.indexOf(a)||-1!==g.indexOf(a)||-1!==l.indexOf(a)||-1!==n.indexOf(a))f=B.r(c,"{[postitemtitle]}",f),g=B.r(f,"{[postitemintro]}",g+"..."),l=B.r(g,"{[postitemdate]}",l),l=B.r(l,"{[postitemlink]}","post-"+k+".html"),h+=l}""==h&&(h="\x3ch2\x3e\u5565\u90fd\u6ca1\u627e\u5230\x3c/h2\x3e");window.scrollTo(0,0);SC("postitems").innerHTML=h;SC("morebtn").style.display="none";PJAX.start()}}else this.hashexist&&(this.realpage=1,this.switchpage=0,this.hashexist=!1)},loadshow:function(){setTimeout(function(){SC("loading").style.opacity=1;SC("loading").style.zIndex=200},100)},loadhide:function(){setTimeout(function(){SC("loading").style.opacity=0;SC("loading").style.zIndex=-1},100)},more:function(){var c=this.itempage+1,a=0,d=0,h="",l=window.mainjson,k=window.htmls[window.templjson.templatehtmls.postitem],f=parseInt(l.posts_per_page),l=window.mainjson,g=l.dateindex,n;for(n in g)if(c<=d){if(a<f){var g=n.replace("post",""),m=l.postindex[g];if(m.link)--a;else var p=B.r(k,"{[postitemtitle]}",Base64.decode(m.title)),p=B.r(p,"{[postitemintro]}",Base64.decode(m.intro)+"..."),m=B.r(p,"{[postitemdate]}",m.date),g=B.r(m,"{[postitemlink]}","post-"+g+".html"),h=h+g;a+=1}}else d+=1;""==h?(h="\x3ch3 style\x3d'color:#AAA;'\x3e\u6ca1\u6709\u66f4\u591a\u4e86\u5462\x3c/h3\x3e",SC("morebtn").style.display="none"):SC("morebtn").style.display="block";this.itempage+=f;this.switchpage>=this.moreperpage-1?(window.scrollTo(0,0),SC("postitems").innerHTML=h,this.switchpage=0,this.realpage+=1,window.location.href="#"+this.realpage):(SC("postitems").innerHTML=SC("postitems").innerHTML+h,this.switchpage+=1);PJAX.start()}};window.addEventListener("pjaxstart",function(){B.loadshow()},!1);window.addEventListener("pjaxfinish",function(){B.loadhide()},!1)}var mainhost=window.location.host,dt=(new Date).getTime();if(void 0==PJAX||null==PJAX)var PJAX={index:null===window.history.state?1:window.history.state.page,PJAXStart:new CustomEvent("pjaxstart"),PJAXFinish:new CustomEvent("pjaxfinish"),LoadedPage:{},lasthref:window.location.href,preventurl:[],recenturl:"",replace:"",sel:function(c){this.replace=c},jump:function(c){var a=encodeURIComponent(c),d=this,h=!1,l=d.replace;if(-1!==d.recenturl.indexOf("#")&&-1!==c.indexOf("#"))return!1;-1==d.recenturl.indexOf("#")&&-1!==c.indexOf("#")&&(B.nowpage=0);window.dispatchEvent(d.PJAXStart);if(d.LoadedPage[a])$.ht(d.LoadedPage[a],l,!1),setTimeout(function(){window.dispatchEvent(d.PJAXFinish)},1E3);else{var k=q("r",a,"","","");k.c&&(h=!0,$.ht(k.c,l,!1));$.aj(c,{},{success:function(f){d.recenturl=c;d.LoadedPage[a]=f;h?k.c!==f?(q("w",a,f,timestamp(),""),$.ht(f,l,!1)):q("e",a,"","",1):($.ht(f,l,!1),q("w",a,f,timestamp(),""));setTimeout(function(){window.dispatchEvent(d.PJAXFinish)},1E3)},failed:function(a){window.dispatchEvent(d.PJAXFinish)}},"get","",!0)}},start:function(){var c=this;c.recenturl=window.location.href;var a=document.getElementsByTagName("a"),d;for(d in a)a[d].onclick=function(a){if(-1!==c.preventurl.indexOf(this.href))return!0;window.history.pushState(null,null,this.href);a.preventDefault();c.jump(this.href)};window.onpopstate=function(a){-1!==window.location.href.indexOf(mainhost)&&PJAX.jump(window.location.href)}},pause:function(){window.onpopstate=function(c){return!0}},autoprevent:function(){var c=document.getElementsByTagName("a"),a=window.location.host,d;for(d in c)void 0!==c[d].href&&-1==c[d].href.indexOf(a)&&this.preventurl.push(c[d].href)}};function q(c,a,d,h,l){"undefined"==typeof localStorage.obottle&&(localStorage.obottle="{}");var k=0,f="",g=JSON.parse(localStorage.obottle),n=[];"undefined"!==typeof g[a]&&(k=g[a].t,f=g[a].h);if("w"==c){g=JSON.parse(localStorage.obottle);c={};c.h=d;c.t=h;c.rt=0;g[a]=c;try{localStorage.obottle=JSON.stringify(g)}catch(p){for(var m in g)(20>=Number(g[m].rt)||172800<=Number(h)-Number(g[m].t))&&delete g[m];localStorage.obottle=JSON.stringify(g)}}else{if("r"==c)return n.t=k,n.c=f,n;"e"==c&&(g=JSON.parse(localStorage.obottle),g[a].rt=Number(g[a].rt)+l,localStorage.obottle=JSON.stringify(g))}}function timestamp(){return(new Date).getTime()}B.tpcheck();