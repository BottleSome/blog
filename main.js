/*FrontMainJS - SomeBottle*/
 /*q.js*/
var md;if("object"!==typeof $){$={ls:[],lss:"",aj:function(a,c,d,g,k,h){var f=new XMLHttpRequest,e="",m;for(m in c)e=e+m+"\x3d"+c[m]+"\x26";e=e.substring(0,e.length-1);"get"==g?f.open("get",a,h):"put"==g?(f.open("PUT",a,h),f.setRequestHeader("Content-type","application/json;charset\x3dUTF-8"),e=JSON.stringify(c)):"delete"==g?(f.open("DELETE",a,h),f.setRequestHeader("Content-type","application/json;charset\x3dUTF-8"),e=JSON.stringify(c)):f.open("post",a,h);f.setRequestHeader("Authorization",k);"multipart/form-data"!==g?(f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f.send(e)):f.send(c);f.onreadystatechange=function(){4==f.readyState&&200==f.status?d.success(f.responseText,a):4==f.readyState&&200!==f.status&&d.failed(f.status,a)};h||(void 0!==f.responseText?d.success(f.responseText,a):d.failed(f.status,a))}};var SC=function(a){return"body"==a?document.body:"html"==a?document.getElementsByTagName("html")[0]:document.getElementById(a)};$.script=function(a){$.scripturl||($.scripturl=[]);var c=document.createElement("script"),d=!1,g;for(g in $.ls)if($.ls[g]==a){d=!0;break}d||-1!=$.scripturl.indexOf(a)||($.ls[$.ls.length]=a,c.type="text/javascript",c.src=a,$.scripturl.push(a),document.body.appendChild(c))};$.ht=function(a,c){var d=SC(c);if(!d)return console.log("Unable to find the Element:"+c),!1;d.innerHTML=a;os=d.getElementsByTagName("script");for(d=0;d<os.length;d++)void 0!==os[d].src&&null!==os[d].src&&""!==os[d].src?$.script(os[d].src):eval(os[d].innerHTML)};$.tr=function(a){b=a.split("?");return b[1]?b[0]:a}}if(!B){$.ht("\x3cscript src\x3d'./library.js'\x3e\x3c/script\x3e"+SC("container").innerHTML,"container");window.htmls={};var B={moreperpage:0,r:function(a,c,d,g){if(void 0===g||g)for(;-1!==a.indexOf(c);)a=a.replace(c,d);else a=a.replace(c,d);return a},hr:function(a,c){var d=document.getElementsByTagName("html")[0].innerHTML;document.getElementsByTagName("html")[0].innerHTML=this.r(d,a,c)},gt:function(a,c,d){d=(d=void 0===d?!1:d)?d:document.getElementsByTagName("html")[0].innerHTML;try{return d.split(a)[1].split(c)[0]}catch(g){return!1}},templonload:0,templateloaded:[],tpcheck:function(){var a=this.gt("\x3c!--[PageType]--\x3e","\x3c!--[PageTypeEnd]--\x3e");if(window.templjson)if(window.mainjson||-1===window.templjson.usemain.indexOf(a)){var c=this,d=window.templjson;d.necessary.push(a);a==d.templatehtmls.postlist&&d.necessary.push(d.templatehtmls.postitem);for(var g in d.necessary)if(-1==c.templateloaded.indexOf(d.necessary[g])){c.templonload+=1;var k=!1,h=q("r","template-"+d.necessary[g],"","","");h.c&&(k=!0,a=d.necessary[g],console.log("Template using cache:"+a),window.htmls[a]=h.c,c.templateloaded.push(a),--c.templonload);$.aj(d.necessary[g],"",{success:function(a,d){window.htmls[d]=a;k?h.c!==a?q("w","template-"+d,a,timestamp(),""):q("e","template-"+d,"","",1):(c.templateloaded.push(d),--c.templonload,q("w","template-"+d,a,timestamp(),""))},failed:function(a){}},"get","",!0)}var f=setInterval(function(){0>=c.templonload&&(clearInterval(f),c.renderer())},1E3)}else{var c=this;setTimeout(function(){return c.tpcheck()},500)}else{var e=this;$.aj("template.json","",{success:function(a){window.templjson=JSON.parse(a);return e.tpcheck()},failed:function(a){}},"get","",!0)}window.mainjson||window.mainjsonrequest||(e=this,window.mainjsonrequest=!0,$.aj("main.json","",{success:function(a){window.mainjson=JSON.parse(a.replace(/[\r\n]/g,""));e.moreperpage=parseInt(window.mainjson.more_per_page)},failed:function(a){}},"get","",!0))},itempage:0,switchpage:0,nowpage:0,realpage:1,searchw:"",hashexist:!1,renderer:function(){var a=window.templjson;md=new Markdown.Converter;var c=window.htmls[a.templatehtmls.cloth],d=window.htmls[a.templatehtmls.main],g=window.htmls[a.templatehtmls.comment],k=this.gt("\x3c!--[PageType]--\x3e","\x3c!--[PageTypeEnd]--\x3e"),h=window.mainjson;if(k==a.templatehtmls.post){var f=this.gt("\x3c!--[PostContent]--\x3e","\x3c!--[PostContentEnd]--\x3e"),e=this.gt("\x3c!--[PostTitle]--\x3e","\x3c!--[PostTitleEnd]--\x3e"),h=this.gt("\x3c!--[PostDate]--\x3e","\x3c!--[PostDateEnd]--\x3e"),m=this.gt("\x3c!--[PostTag]--\x3e","\x3c!--[PostTagEnd]--\x3e"),l=this.gt("\x3c!--[PostID]--\x3e","\x3c!--[PostIDEnd]--\x3e"),n=this.gt("\x3c!--[MainTitle]--\x3e","\x3c!--[MainTitleEnd]--\x3e").replace(/<\/?.+?>/g,""),f=this.r(window.htmls[a.templatehtmls.post],"{[postcontent]}",md.makeHtml(f.trim())),e=this.r(f,"{[posttitle]}",e),f=[];isNaN(h)?m="\u9875\u9762":(f=m.split(","),m="",f.forEach(function(c,d){m=m+'\x3ca href\x3d"'+a.generatehtmls.tags+"#"+encodeURIComponent(c)+'" class\x3d"taglink"\x3e'+c+"\x3c/a\x3e,"}),m=m.substr(0,m.length-1));e=this.r(e,"{[posttags]}",m);e=this.r(e,"{[postdate]}",h);d=this.r(d,"{[contents]}",e);c=this.r(c,"{[main]}",d);c=this.r(c,"{[title]}",n);c=this.r(c,"{[comments]}",g);c=this.r(c,"{[pid]}",l);c=this.r(c,"{[pagetype]}",k);isNaN(h)&&(c=c.split("\x3c!--PostEnd--\x3e")[0]+"\x3c!--PostEnd--\x3e");$.ht(c,"container");this.loadhide()}else if(k==a.templatehtmls.postlist){var r=this,f=this.gt("\x3c!--[PostContent]--\x3e","\x3c!--[PostContentEnd]--\x3e"),n=this.gt("\x3c!--[MainTitle]--\x3e","\x3c!--[MainTitleEnd]--\x3e").replace(/<\/?.+?>/g,""),n=n.replace("-",""),f=this.r(window.htmls[a.templatehtmls.postlist],"{[postitems]}",md.makeHtml(f.trim())),d=this.r(d,"{[contents]}",f),c=this.r(c,"{[main]}",d),c=this.r(c,"{[title]}",n),c=this.r(c,"{[pagetype]}",k);this.itempage=parseInt(h.posts_per_page);$.ht(c,"container");this.loadhide();var u=setInterval(function(){if(r.gt("\x3c!--[PageType]","[PageTypeEnd]--\x3e")!==a.templatehtmls.postlist)return PJAX.sel("container"),PJAX.start(),clearInterval(u),!1;r.indexpagechecker()},500)}else if(k==a.templatehtmls.archives){var n=this.gt("\x3c!--[MainTitle]--\x3e","\x3c!--[MainTitleEnd]--\x3e").replace(/<\/?.+?>/g,""),g=h.dateindex,p="",w=0;for(f in g)l=g[f].toString().substring(0,4),l!==w&&(w=l,p=""!==p?p+("\x3c/ul\x3e\x3ch2\x3e\u00b7 "+l+"\x3c/h2\x3e\x3cul\x3e"):p+("\x3ch2\x3e\u00b7 "+l+"\x3c/h2\x3e\x3cul\x3e")),l=f.replace("post",""),e=Base64.decode(h.postindex[l].title),p=h.postindex[l].link?p+("\x3cli\x3e\x3ca class\x3d'taglink' href\x3d'"+h.postindex[l].link+".html'\x3e"+e+"\x3c/a\x3e\x3c/li\x3e"):p+("\x3cli\x3e\x3ca class\x3d'taglink' href\x3d'post-"+l+".html'\x3e"+e+"\x3c/a\x3e\x3c/li\x3e");f=this.r(window.htmls[a.templatehtmls.archives],"{[archives]}",p+"\x3c/ul\x3e");d=this.r(d,"{[contents]}",f);c=this.r(c,"{[main]}",d);c=this.r(c,"{[title]}",n);c=this.r(c,"{[pagetype]}",k);$.ht(c,"container");this.loadhide()}else if(k==a.templatehtmls.tags){var n=this.gt("\x3c!--[MainTitle]--\x3e","\x3c!--[MainTitleEnd]--\x3e").replace(/<\/?.+?>/g,""),g=$.tr(window.location.href),t="",r=this,h=h.postindex,v=[];for(e in h)l=h[e].tags.split(","),l.forEach(function(a,c){""!==a&&-1==v.indexOf(a)&&v.push(a)});v.forEach(function(a,c){t+="[\x3ca href\x3d'#"+encodeURIComponent(a)+"' class\x3d'itemlink'\x3e"+a+"\x3c/a\x3e]"});this.alltaghtml=t;-1!==g.indexOf("#")&&(this.nowtag=l=g.split("#")[1],"alltags"!==l&&(t="\x3cscript\x3eB.taguper('"+l+"');PJAX.start();\x3c/script\x3e"));u=setInterval(function(){if(-1==window.location.href.indexOf(a.generatehtmls.tags)&&-1==window.location.href.indexOf(a.generatehtmls.tags.replace(".html","")))return PJAX.sel("container"),PJAX.start(),clearInterval(u),!1;r.tagpagechecker()},500);f=this.r(window.htmls[a.templatehtmls.tags],"{[tags]}",t);d=this.r(d,"{[contents]}",f);c=this.r(c,"{[main]}",d);c=this.r(c,"{[title]}",n);c=this.r(c,"{[pagetype]}",k);$.ht(c,"container");this.loadhide()}},nowtag:"",alltaghtml:"",taguper:function(a){a=decodeURIComponent(a);document.getElementsByTagName("html");var c=window.mainjson,d=c.dateindex,g=c.postindex,c=[],k="",h;for(h in d)d=h.replace("post",""),-1!==g[d].tags.indexOf(a)&&c.push(d);k+="\x3cul\x3e";c.forEach(function(a,c){var d=g[a],e="post-"+a+".html";d.link&&(e=d.link+".html");k+="\x3cli\x3e\x3ca class\x3d'taglink' href\x3d'"+e+"'\x3e"+Base64.decode(d.title)+"\x3c/a\x3e\x3c/li\x3e"});SC("tags").innerHTML=k},tagpagechecker:function(){document.getElementsByTagName("html");var a=$.tr(window.location.href);-1==a.indexOf("#")?(PJAX.pause(),window.location.href+="#alltags",PJAX.start()):(a=a.split("#")[1],this.nowtag!==a&&(this.nowtag=a,"alltags"==a?SC("tags")&&(SC("tags").innerHTML=this.alltaghtml):this.taguper(a),PJAX.start()))},indexpagechecker:function(){document.getElementsByTagName("html");var a=window.templjson,c=$.tr(decodeURIComponent(window.location.href)),d=window.mainjson,g=parseInt(d.posts_per_page);if(-1!==c.indexOf("#")){this.hashexist=!0;var k=c.split("#")[1];if(-1==c.indexOf("#!")){if(!isNaN(k)){var h=parseInt(k)-1;this.nowpage!==h&&(this.nowpage=h,this.itempage=g*h*this.moreperpage,SC("postitems").innerHTML="",this.more(),this.realpage=h+1,this.switchpage=0)}}else if(g="",a=window.htmls[a.templatehtmls.postitem],c=c.split("#!")[1],c!==this.searchw){this.searchw=c;d=d.postindex;for(h in d){var f=Base64.decode(d[h].title),e=Base64.decode(d[h].intro),k=d[h].date,m=d[h].tags;if(-1!==f.indexOf(c)||-1!==e.indexOf(c)||-1!==k.indexOf(c)||-1!==m.indexOf(c))f=B.r(a,"{[postitemtitle]}",f),e=B.r(f,"{[postitemintro]}",e+"..."),k=B.r(e,"{[postitemdate]}",k),k=B.r(k,"{[postitemlink]}","post-"+h+".html"),g+=k}""==g&&(g="\x3ch2\x3e\u5565\u90fd\u6ca1\u627e\u5230\x3c/h2\x3e");window.scrollTo(0,0);SC("postitems").innerHTML=g;SC("morebtn").style.display="none";PJAX.start()}}else this.hashexist&&(this.realpage=1,this.switchpage=0,this.hashexist=!1)},loadshow:function(){SC("loading").style.opacity=1;SC("loading").style.zIndex=200},loadhide:function(){SC("loading").style.opacity=0;SC("loading").style.zIndex=-1},more:function(){var a=this.itempage+1,c=0,d=0,g="",k=window.mainjson,h=window.htmls[window.templjson.templatehtmls.postitem],f=parseInt(k.posts_per_page),k=window.mainjson,e=k.dateindex,m;for(m in e)if(a<=d){if(c<f){var e=m.replace("post",""),l=k.postindex[e];if(l.link)--c;else var n=B.r(h,"{[postitemtitle]}",Base64.decode(l.title)),n=B.r(n,"{[postitemintro]}",Base64.decode(l.intro)+"..."),l=B.r(n,"{[postitemdate]}",l.date),e=B.r(l,"{[postitemlink]}","post-"+e+".html"),g=g+e;c+=1}}else d+=1;""==g?(g="\x3ch3 style\x3d'color:#AAA;'\x3e\u6ca1\u6709\u66f4\u591a\u4e86\u5462\x3c/h3\x3e",SC("morebtn").style.display="none"):SC("morebtn").style.display="block";this.itempage+=f;this.switchpage>=this.moreperpage-1?(window.scrollTo(0,0),SC("postitems").innerHTML=g,this.switchpage=0,this.realpage+=1,window.location.href="#"+this.realpage):(SC("postitems").innerHTML=SC("postitems").innerHTML+g,this.switchpage+=1);PJAX.start()}};window.addEventListener("pjaxstart",function(){B.loadshow()},!1);window.addEventListener("pjaxfinish",function(){B.loadhide()},!1)}var mainhost=window.location.host,dt=(new Date).getTime();if(void 0==PJAX||null==PJAX)var PJAX={index:null===window.history.state?1:window.history.state.page,PJAXStart:new CustomEvent("pjaxstart"),PJAXFinish:new CustomEvent("pjaxfinish"),lasthref:window.location.href,preventurl:[],recenturl:"",replace:"",sel:function(a){this.replace=a},jump:function(a){var c=this,d=!1;if(-1!==c.recenturl.indexOf("#")&&-1!==a.indexOf("#"))return!1;-1==c.recenturl.indexOf("#")&&-1!==a.indexOf("#")&&(B.nowpage=0);window.dispatchEvent(c.PJAXStart);var g=q("r",encodeURIComponent(a),"","","");g.c&&(d=!0,$.ht(g.c,c.replace));$.aj(a,{},{success:function(k){var h=c.replace;c.recenturl=a;d?g.c!==k?(q("w",encodeURIComponent(a),k,timestamp(),""),$.ht(k,h)):q("e",encodeURIComponent(a),"","",1):($.ht(k,h),q("w",encodeURIComponent(a),k,timestamp(),""));window.dispatchEvent(c.PJAXFinish)},failed:function(a){window.dispatchEvent(c.PJAXFinish)}},"get","",!0)},start:function(){var a=this;a.recenturl=window.location.href;var c=document.getElementsByTagName("a"),d;for(d in c)c[d].onclick=function(c){if(-1!==a.preventurl.indexOf(this.href))return!0;window.history.pushState(null,null,this.href);c.preventDefault();a.jump(this.href)};window.onpopstate=function(a){-1!==window.location.href.indexOf(mainhost)&&PJAX.jump(window.location.href)}},pause:function(){window.onpopstate=function(a){return!0}},autoprevent:function(){var a=document.getElementsByTagName("a"),c=window.location.host,d;for(d in a)void 0!==a[d].href&&-1==a[d].href.indexOf(c)&&this.preventurl.push(a[d].href)}};function q(a,c,d,g,k){"undefined"==typeof localStorage.obottle&&(localStorage.obottle="{}");var h=0,f="",e=JSON.parse(localStorage.obottle),m=[];"undefined"!==typeof e[c]&&(h=e[c].t,f=e[c].h);if("w"==a){e=JSON.parse(localStorage.obottle);a={};a.h=d;a.t=g;a.rt=0;e[c]=a;try{localStorage.obottle=JSON.stringify(e)}catch(n){for(var l in e)(20>=Number(e[l].rt)||172800<=Number(g)-Number(e[l].t))&&delete e[l];localStorage.obottle=JSON.stringify(e)}}else{if("r"==a)return m.t=h,m.c=f,m;"e"==a&&(e=JSON.parse(localStorage.obottle),e[c].rt=Number(e[c].rt)+k,localStorage.obottle=JSON.stringify(e))}}function timestamp(){return(new Date).getTime()};