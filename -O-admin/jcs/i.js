"use strict";function typer(){var e=SC("r").value;$.ce(e)&&(window.githubrepo=SC("r").value,loadshow(),blog.getrepo(window.accesstoken,e,!0,{success:function(e){loadhide(),SC("f").style.marginTop="1000px",setTimeout(initialcheck,1e3),lc("githubrepo",window.githubrepo)},failed:function(e){listener(),notice("No Such Repo."),loadhide()}}),document.onkeydown=function(){return!0})}function initialcheck(){var n,t,i;loadshow(),new Promise(function(o,e){console.log("Trying to get templatejson from the remote repo."),blog.getfile(window.accesstoken,window.githubrepo,"template.json",!0,{success:function(e){n=Base64.decode(e.content),window.tjson=n,t=JSON.parse(n),o(e)},failed:function(e){console.log("No template.json in the remote repo."),$.ft("./template/template.json",{},{success:function(e){window.tjson=JSON.parse(e),initialization()},failed:function(e){notice("Initialization Failed.")}},"get","")}})}).then(function(e){return new Promise(function(o,e){blog.getfile(window.accesstoken,window.githubrepo,t.templatehtmls.postitem,!0,{success:function(e){i=Base64.decode(e.content),window.htmls["postitem.html"]=i,o(e)},failed:function(e){notice("Failed to get Necessary Template."),loadhide(),errshow()}})})}).then(function(e){return new Promise(function(o,e){blog.getfileshas(window.accesstoken,window.githubrepo,!0,{success:function(e){window.fileshas=e,o(blog.findfilesha(t.mainjson))},failed:function(e){notice("Failed to get file shas."),loadhide(),errshow()}})})}).then(function(e){blog.getfileblob(window.accesstoken,window.githubrepo,e,!0,{success:function(e){window.mainjson=e,loadhide(),PJAX.jump("editor.html")},failed:function(e){notice("Failed to get Main.json."),loadhide(),errshow()}})}),notice("Checking...")}function initialization(){if(confirm("即将帮您初始化博客，是否继续？\nReady for initialization, please confirm to continue.")){notice("Initializing...");var e,o=window.tjson.alltp,n=[];for(e in o)console.log("file:"+o[e]),function(o){$bueue.c(function(){$.ft("./template/"+o,{},{success:function(e){notice(o),blog.cr(window.accesstoken,window.githubrepo,e,{success:function(e){n.push({path:o,mode:"100644",type:"blob",sha:e.sha}),$bueue.next()},failed:function(e){notice("初始化出错",!0),notice("请删除template.json."),notice("重新初始化."),errshow()}})},failed:function(e){notice("初始化出错",!0),notice("请删除template.json."),notice("重新初始化."),errshow()}},"get","")})}(o[e]);$bueue.c(()=>{notice("All template blobs have been made")}),$bueue.start();var t=setInterval(function(){3==$bueue.state&&window.gstate<=0&&blog.gpush(window.accesstoken,window.githubrepo,n,"Initial commit of -O-",{success:e=>{notice("Finished"),notice("五秒后将刷新页面"),SC("t").style.opacity=0,setTimeout(function(){location.reload()},5e3),loadhide(),clearInterval(t)},failed:e=>{notice("Commit提交失败",!0),errshow()}})},1e3)}else alert("如果想好了，刷新页面初始化吧！")}$bueue.de(!0);